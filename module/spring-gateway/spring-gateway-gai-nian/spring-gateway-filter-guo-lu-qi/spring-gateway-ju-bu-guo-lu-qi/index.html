<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>【Spring Gateway】 局部过滤器 | 蝶梦庄生</title><meta name="keywords" content="SpringGateway"><meta name="author" content="Bill Cipher"><meta name="copyright" content="Bill Cipher"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="【Spring Gateway】 局部过滤器">
<meta property="og:type" content="article">
<meta property="og:title" content="【Spring Gateway】 局部过滤器">
<meta property="og:url" content="https://yu627482453.github.io/module/spring-gateway/spring-gateway-gai-nian/spring-gateway-filter-guo-lu-qi/spring-gateway-ju-bu-guo-lu-qi/index.html">
<meta property="og:site_name" content="蝶梦庄生">
<meta property="og:description" content="【Spring Gateway】 局部过滤器">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://api.yimian.xyz/img?type=moe">
<meta property="article:published_time" content="2023-02-14T01:05:00.000Z">
<meta property="article:modified_time" content="2023-02-14T01:05:00.000Z">
<meta property="article:author" content="Bill Cipher">
<meta property="article:tag" content="行动阶段&#x2F;完成">
<meta property="article:tag" content="主题场景&#x2F;组件">
<meta property="article:tag" content="笔记空间&#x2F;KnowladgeSpace&#x2F;ProgramSpace&#x2F;ModuleSpace">
<meta property="article:tag" content="细化主题&#x2F;Module&#x2F;SpringGateway">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://api.yimian.xyz/img?type=moe"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://yu627482453.github.io/module/spring-gateway/spring-gateway-gai-nian/spring-gateway-filter-guo-lu-qi/spring-gateway-ju-bu-guo-lu-qi/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Bill Cipher","link":"链接: ","source":"来源: 蝶梦庄生","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【Spring Gateway】 局部过滤器',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-14 09:05:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">600</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">147</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">21</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://api.yimian.xyz/img?type=moe')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">蝶梦庄生</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【Spring Gateway】 局部过滤器</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-14T01:05:00.000Z" title="发表于 2023-02-14 09:05:00">2023-02-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-14T01:05:00.000Z" title="更新于 2023-02-14 09:05:00">2023-02-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SpringGateway/">SpringGateway</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【Spring Gateway】 局部过滤器"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>【Spring Gateway】 局部过滤器</h1>
<h2 id="Metadata-561">Metadata</h2>
<pre><code class="language-yml">title: 【Spring Gateway】 局部过滤器
date: 2023-02-14 09:05
tags:
  - 行动阶段/完成
  - 主题场景/组件
  - 笔记空间/KnowladgeSpace/ProgramSpace/ModuleSpace
  - 细化主题/Module/SpringGateway
categories:
  - SpringGateway
keywords:
  - SpringGateway
description: 【Spring Gateway】 局部过滤器
</code></pre>
<h2 id="【Spring-Gateway】-局部过滤器-2">【Spring Gateway】 局部过滤器</h2>
<h3 id="AddRequestHeader">AddRequestHeader</h3>
<p>AddRequestHeader GatewayFilter工厂接受一个名称和值参数。配置AddRequestHeader网关过滤器的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: add_request_header_route
        uri: https://example.org
        filters:
        - AddRequestHeader=X-Request-red, blue
</code></pre>
<p>该清单将X-Request-red:blue报头添加到所有匹配请求的下游请求报头中。</p>
<p>AddRequestHeader知道用于匹配路径或主机的URI变量。URI变量可以在值中使用，并在运行时展开。下面的例子配置了一个使用变量的AddRequestHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: add_request_header_route
        uri: https://example.org
        predicates:
        - Path=/red/{segment}
        filters:
        - AddRequestHeader=X-Request-Red, Blue-{segment}
</code></pre>
<h3 id="AddRequestParameter">AddRequestParameter</h3>
<p>AddRequestParameter GatewayFilter Factory接受一个名称和值参数。配置AddRequestParameter GatewayFilter的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: add_request_parameter_route
        uri: https://example.org
        filters:
        - AddRequestParameter=red, blue
</code></pre>
<p>这将为所有匹配的请求将red=blue添加到下游请求的查询字符串中。<br>
AddRequestParameter知道用于匹配路径或主机的URI变量。URI变量可以在值中使用，并在运行时展开。下面的例子配置了一个AddRequestParameter GatewayFilter，它使用了一个变量:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: add_request_parameter_route
        uri: https://example.org
        predicates:
        - Host: {segment}.myhost.org
        filters:
        - AddRequestParameter=foo, bar-{segment}
</code></pre>
<h3 id="AddResponseHeader">AddResponseHeader</h3>
<p>AddResponseHeader GatewayFilter Factory接受一个名称和值参数。配置AddResponseHeader GatewayFilter的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: add_response_header_route
        uri: https://example.org
        filters:
        - AddResponseHeader=X-Response-Red, Blue
</code></pre>
<p>这将把X-Response-Red:Blue报头添加到所有匹配请求的下游响应报头中。</p>
<p>AddResponseHeader知道用于匹配路径或主机的URI变量。URI变量可以在值中使用，并在运行时展开。下面的示例配置了一个使用变量的AddResponseHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: add_response_header_route
        uri: https://example.org
        predicates:
        - Host: {segment}.myhost.org
        filters:
        - AddResponseHeader=foo, bar-{segment}
</code></pre>
<h3 id="DedupeResponseHeader">DedupeResponseHeader</h3>
<p>DedupeResponseHeader GatewayFilter工厂接受一个名称参数和一个可选的策略参数。名称可以包含以空格分隔的标题名称列表。配置DedupeResponseHeader GatewayFilter的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: dedupe_response_header_route
        uri: https://example.org
        filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
</code></pre>
<p>当网关CORS逻辑和下游逻辑同时添加Access-Control-Allow-Credentials和Access-Control-Allow-Origin响应标头时，这将删除它们的重复值。</p>
<p>DedupeResponseHeader过滤器还接受一个可选的策略参数。接受的值是RETAIN_FIRST(默认值)、RETAIN_LAST和RETAIN_UNIQUE。</p>
<h3 id="CircuitBreaker">CircuitBreaker</h3>
<p>Spring Cloud circuit breaker网关过滤器工厂使用Spring Cloud circuit breaker api将网关路由封装在一个断路器中。Spring Cloud CircuitBreaker支持多个可以与Spring Cloud Gateway一起使用的库。Spring Cloud开箱即用地支持Resilience4J。</p>
<p>要启用Spring Cloud CircuitBreaker过滤器，您需要在类路径上放置<code>Spring-Cloud-starter-CircuitBreaker-reactor-resili4j</code>。配置Spring Cloud CircuitBreaker GatewayFilter的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: circuitbreaker_route
        uri: https://example.org
        filters:
        - CircuitBreaker=myCircuitBreaker
</code></pre>
<p>要配置断路器，请参阅您正在使用的底层断路器实现的配置。</p>
<p>Spring Cloud CircuitBreaker过滤器也可以接受一个可选的fallbackUri参数。目前只支持forward: scheme uri。如果调用了回退，则请求被转发到与URI匹配的控制器。下面的示例配置这样一个回退:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: circuitbreaker_route
        uri: lb://backing-service:8088
        predicates:
        - Path=/consumingServiceEndpoint
        filters:
        - name: CircuitBreaker
          args:
            name: myCircuitBreaker
            fallbackUri: forward:/inCaseOfFailureUseThis
        - RewritePath=/consumingServiceEndpoint, /backingServiceEndpoint
</code></pre>
<p>下面的清单在Java中做了同样的事情:</p>
<pre><code class="language-java">@Bean
public RouteLocator routes(RouteLocatorBuilder builder) {
    return builder.routes()
        .route("circuitbreaker_route", r -&gt; r.path("/consumingServiceEndpoint")
            .filters(f -&gt; f.circuitBreaker(c -&gt; c.name("myCircuitBreaker").fallbackUri("forward:/inCaseOfFailureUseThis"))
                .rewritePath("/consumingServiceEndpoint", "/backingServiceEndpoint")).uri("lb://backing-service:8088")
        .build();
}
</code></pre>
<p>当断路器回退被调用时，这个例子转发到/inCaseofFailureUseThis URI。注意，这个示例还演示了(可选的)Spring Cloud LoadBalancer负载均衡(由目标URI上的lb前缀定义)。</p>
<p>主要场景是使用fallbackUri在网关应用程序中定义内部控制器或处理程序。但是，你也可以将请求重新路由到外部应用程序中的控制器或处理程序，如下所示:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: ingredients
        uri: lb://ingredients
        predicates:
        - Path=//ingredients/**
        filters:
        - name: CircuitBreaker
          args:
            name: fetchIngredients
            fallbackUri: forward:/fallback
      - id: ingredients-fallback
        uri: http://localhost:9994
        predicates:
        - Path=/fallback
</code></pre>
<p>在本例中，网关应用程序中没有回退端点或处理程序。但是，在另一个应用程序中有一个，在localhost:9994下注册。</p>
<p>如果请求被转发到回退，Spring Cloud CircuitBreaker Gateway过滤器还提供了引起它的Throwable。作为添加到ServerWebExchange。<code>ServerWebExchangeUtils.CIRCUITBREAKER_EXECUTION_EXCEPTION_ATTR</code>属性，可以在网关应用程序中处理回退时使用。</p>
<p>对于外部控制器/处理器场景，可以添加带有异常详细信息的标头。您可以在FallbackHeaders GatewayFilter Factory一节中找到更多关于这样做的信息。</p>
<h3 id="FallbackHeaders">FallbackHeaders</h3>
<p>FallbackHeaders工厂允许您在转发到外部应用程序中的fallbackUri的请求头中添加Spring Cloud CircuitBreaker执行异常详细信息，如下所示:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: ingredients
        uri: lb://ingredients
        predicates:
        - Path=//ingredients/**
        filters:
        - name: CircuitBreaker
          args:
            name: fetchIngredients
            fallbackUri: forward:/fallback
      - id: ingredients-fallback
        uri: http://localhost:9994
        predicates:
        - Path=/fallback
        filters:
        - name: FallbackHeaders
          args:
            executionExceptionTypeHeaderName: Test-Header
</code></pre>
<p>在本例中，在运行断路器时发生执行异常后，请求被转发到运行在localhost:9994上的应用程序中的回退端点或处理程序。FallbackHeaders过滤器将带有异常类型、消息以及(如果可用)根原因异常类型和消息的报头添加到该请求中。</p>
<p>您可以通过设置以下参数的值(显示其默认值)来覆盖配置中的头的名称:</p>
<ul>
<li>executionExceptionTypeHeaderName (“Execution-Exception-Type”)</li>
<li>executionExceptionMessageHeaderName (“Execution-Exception-Message”)</li>
<li>rootCauseExceptionTypeHeaderName (“Root-Cause-Exception-Type”)</li>
<li>rootCauseExceptionMessageHeaderName (“Root-Cause-Exception-Message”)</li>
</ul>
<h3 id="MapRequestHeader">MapRequestHeader</h3>
<p>MapRequestHeader GatewayFilter工厂接受fromHeader和toHeader参数。它创建了一个新的命名头(toHeader)，该值从传入的http请求中已存在的命名头(fromHeader)中提取出来。如果输入头不存在，筛选器就没有影响。如果新的命名头已经存在，则它的值将使用新值进行扩充。配置MapRequestHeader的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: map_request_header_route
        uri: https://example.org
        filters:
        - MapRequestHeader=Blue, X-Request-Red
</code></pre>
<p>这将<code>X-Request-Red:&lt;values&gt;</code>报头添加到下游请求，并使用来自传入HTTP请求的蓝色报头的更新值。</p>
<h3 id="PrefixPath">PrefixPath</h3>
<p>PrefixPath GatewayFilter工厂接受一个前缀参数。使用实例配置PrefixPath GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: prefixpath_route
        uri: https://example.org
        filters:
        - PrefixPath=/mypath
</code></pre>
<p>这将在所有匹配请求的路径前加上/mypath前缀。因此，对/hello的请求将被发送到/mypath/hello。</p>
<h3 id="PreserveHostHeader">PreserveHostHeader</h3>
<p>PreserveHostHeader GatewayFilter工厂没有参数。这个筛选器设置一个请求属性，路由筛选器检查该属性以确定是否应该发送原始的主机报头，而不是HTTP客户端确定的主机报头。配置一个PreserveHostHeader网关过滤器的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: preserve_host_route
        uri: https://example.org
        filters:
        - PreserveHostHeader
</code></pre>
<h3 id="RequestRateLimiter">RequestRateLimiter</h3>
<p>RequestRateLimiter GatewayFilter工厂使用一个RateLimiter实现来确定当前请求是否被允许继续。如果不是，返回HTTP 429 - Too Many Requests(默认)的状态。</p>
<p>该过滤器接受一个可选的keyResolver参数和特定于速率限制器的参数(本节稍后将介绍)。</p>
<p>keyResolver是一个实现keyResolver接口的bean。在配置中，使用SpEL按名称引用bean。<code>#{@myKeyResolver}</code>是一个引用名为myKeyResolver的bean的SpEL表达式。下面的清单显示了KeyResolver接口:</p>
<pre><code class="language-java">public interface KeyResolver {
    Mono&lt;String&gt; resolve(ServerWebExchange exchange);
}
</code></pre>
<p>KeyResolver接口允许可插策略派生用于限制请求的键。在未来的里程碑版本中，将会有一些KeyResolver实现。</p>
<p>KeyResolver的默认实现是PrincipalNameKeyResolver，它从ServerWebExchange中检索Principal并调用Principal. getname()。</p>
<p>默认情况下，如果KeyResolver没有找到密钥，请求将被拒绝。你可以通过设置<code>spring.cloud.gateway.filter.request-rate- limititer.deny-empty-key</code> (true或false)和<code>spring.cloud.gateway.filter.request-rate- limititer</code>来调整这种行为。empty-key-status-code属性。</p>
<h4 id="The-Redis-RateLimiter">The Redis RateLimiter</h4>
<p>Redis的实现基于Stripe所做的工作。它需要使用Spring - Boot -starter-data-redis-reactive Spring Boot启动程序。</p>
<p>redis-rate-limiter。属性是指在不丢弃任何请求的情况下，允许用户每秒执行多少个请求。这是令牌桶被填充的速率。</p>
<p>redis-rate-limiter。burstCapacity属性是允许用户在一秒钟内执行的最大请求数。这是令牌桶可以容纳的令牌数量。将该值设置为0将阻塞所有请求。</p>
<p>redis-rate-limiter。requestedTokens属性表示请求花费了多少令牌。这是为每个请求从桶中取出的令牌数量，默认为1。</p>
<p>一个稳定的速率是通过在“补速率”和“爆裂容量”中设置相同的值来实现的。可以通过将burstCapacity设置为高于replenishRate来允许临时爆发。在这种情况下，需要允许速率限制器在爆发之间有一定的时间(根据replenishRate)，因为连续两次爆发将导致请求丢失(HTTP 429 -太多请求)。下面的清单配置了一个redis-rate- limititer:</p>
<p>1请求/秒以下的速率限制是通过将replenishRate设置为所需的请求数量，将requestedTokens设置为以秒为单位的时间间隔，将burstCapacity设置为replenishRate和requestedTokens的乘积来实现的，例如设置replenishRate=1, requestedTokens=60和burstCapacity=60将导致1个请求/分钟的限制。</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: requestratelimiter_route
        uri: https://example.org
        filters:
        - name: RequestRateLimiter
          args:
            redis-rate-limiter.replenishRate: 10
            redis-rate-limiter.burstCapacity: 20
            redis-rate-limiter.requestedTokens: 1
</code></pre>
<p>在Java中配置KeyResolver的示例如下:</p>
<pre><code class="language-java">@Bean
KeyResolver userKeyResolver() {
    return exchange -&gt; Mono.just(exchange.getRequest().getQueryParams().getFirst("user"));
}
</code></pre>
<h3 id="RedirectTo">RedirectTo</h3>
<p>RedirectTo GatewayFilter工厂接受两个参数: status和url。status参数应该是一个300系列重定向HTTP代码，例如301。url参数应该是一个有效的url。这是Location报头的值。对于相对重定向，你应该使用uri: no://op作为路由定义的uri。下面的清单配置了一个RedirectTo GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: prefixpath_route
        uri: https://example.org
        filters:
        - RedirectTo=302, https://acme.org
</code></pre>
<p>这将发送带有<code>Location:https://acme.org</code>报头的状态302来执行重定向。</p>
<h3 id="RemoveRequestHeader">RemoveRequestHeader</h3>
<p>RemoveRequestHeader GatewayFilter工厂接受一个name参数。它是要删除的标头的名称。下面的清单配置了一个RemoveRequestHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: removerequestheader_route
        uri: https://example.org
        filters:
        - RemoveRequestHeader=X-Request-Foo
</code></pre>
<p>这将在X-Request-Foo头发送到下游之前删除它。</p>
<h3 id="RemoveResponseHeader">RemoveResponseHeader</h3>
<p>RemoveResponseHeader GatewayFilter工厂接受一个name参数。它是要删除的标头的名称。下面的清单配置了一个RemoveResponseHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: removeresponseheader_route
        uri: https://example.org
        filters:
        - RemoveResponseHeader=X-Response-Foo
</code></pre>
<p>这将在响应返回到网关客户端之前从响应中删除X-Response-Foo报头。</p>
<p>要删除任何类型的敏感报头，您应该为任何您想要这样做的路由配置此过滤器。此外，您可以使用<code>spring.cloud.gateway.default-filters</code>配置此过滤器一次，并将其应用于所有路由。</p>
<h3 id="RemoveRequestParameter">RemoveRequestParameter</h3>
<p>RemoveRequestParameter GatewayFilter工厂接受一个name参数。它是要删除的查询参数的名称。使用实例配置RemoveRequestParameter GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: removerequestparameter_route
        uri: https://example.org
        filters:
        - RemoveRequestParameter=red
</code></pre>
<p>这将在发送到下游之前删除红色参数。</p>
<h3 id="RequestHeaderSize">RequestHeaderSize</h3>
<p>RequestHeaderSize GatewayFilter工厂接受maxSize和errorHeaderName参数。maxSize参数是请求头允许的最大数据大小(包括键和值)。参数errorHeaderName设置包含错误消息的响应头的名称，默认为"errorMessage"。下面的清单配置了一个RequestHeaderSize GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: requestheadersize_route
        uri: https://example.org
        filters:
        - RequestHeaderSize=1000B
</code></pre>
<p>如果任何请求头的大小大于1000字节，这将发送一个状态431。</p>
<h3 id="RewritePath">RewritePath</h3>
<p>RewritePath GatewayFilter工厂接受一个路径regexp参数和一个替换参数。它使用Java正则表达式作为一种灵活的方式来重写请求路径。下面的清单配置了一个RewritePath GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: rewritepath_route
        uri: https://example.org
        predicates:
        - Path=/red/**
        filters:
        - RewritePath=/red/?(?&lt;segment&gt;.*), /$\{segment}
</code></pre>
<p>对于/red/blue的请求路径，这将在发出下游请求之前将路径设置为/blue。注意，由于YAML规范，<code>$</code>应该替换为<code>$\</code>。</p>
<h3 id="RewriteLocationResponseHeader">RewriteLocationResponseHeader</h3>
<p>RewriteLocationResponseHeader GatewayFilter工厂修改Location响应头的值，通常是为了去掉后端特定的细节。它接受stripVersionMode、locationHeaderName、hostValue和protocolsRegex参数。下面的清单配置了一个RewriteLocationResponseHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: rewritelocationresponseheader_route
        uri: http://example.org
        filters:
        - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,
</code></pre>
<p>例如，对于POST <code>api.example.com/some/object/name</code>的请求，<code>object-service.prod.example.net/v2/some/object/id</code>的Location响应头值被重写为<code>api.example.com/some/object/id</code>。</p>
<p>stripVersionMode参数取值包括:NEVER_STRIP、AS_IN_REQUEST(默认值)和ALWAYS_STRIP。</p>
<ul>
<li>NEVER_STRIP:不剥离版本，即使原始请求路径不包含版本。</li>
<li>AS_IN_REQUEST只有在原始请求路径不包含版本时才会剥离版本。</li>
<li>ALWAYS_STRIP版本总是被剥离，即使原始请求路径包含version。</li>
</ul>
<p>如果提供了hostValue参数，则用于替换响应Location报头的host:port部分。如果没有提供，则使用Host请求头的值。</p>
<p>参数protocolsRegex必须是一个有效的正则表达式字符串，协议名要匹配该正则表达式字符串。如果不匹配，筛选器什么也不做。缺省为http|https|ftp|ftps。</p>
<h3 id="RewriteResponseHeader">RewriteResponseHeader</h3>
<p>RewriteResponseHeader GatewayFilter工厂接受名称、regexp和替换参数。它使用Java正则表达式来灵活地重写响应头值。下面的例子配置一个RewriteResponseHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: rewriteresponseheader_route
        uri: https://example.org
        filters:
        - RewriteResponseHeader=X-Response-Red, , password=[^&amp;]+, password=***
</code></pre>
<p>对于头值为<code>/42?user=ford&amp;password=omg!what&amp;flag=true</code>，它被设置为<code>/42?</code>发出下游请求后<code>user=ford&amp;password=***&amp;flag=true</code>由于YAML规范，您必须使用<code>$\</code>表示<code>$</code>。</p>
<h3 id="SaveSession">SaveSession</h3>
<p>SaveSession GatewayFilter工厂在向下游转发调用之前强制执行WebSession::save操作。这在使用带有惰性数据存储的Spring Session之类的东西时特别有用，并且您需要确保在进行前转调用之前已经保存了会话状态。配置一个SaveSession GatewayFilter的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: save_session
        uri: https://example.org
        predicates:
        - Path=/foo/**
        filters:
        - SaveSession
</code></pre>
<p>如果您将Spring Security与Spring Session集成在一起，并希望确保安全细节已被转发到远程进程，这是至关重要的。</p>
<h3 id="SecureHeaders">SecureHeaders</h3>
<p>SecureHeaders GatewayFilter工厂根据本文的建议向响应中添加了许多报头。</p>
<p>添加以下头部(显示其默认值):</p>
<ul>
<li>X-Xss-Protection:1 (mode=block)</li>
<li>Strict-Transport-Security (max-age=631138519)</li>
<li>X-Frame-Options (DENY)</li>
<li>X-Content-Type-Options (nosniff)</li>
<li>Referrer-Policy (no-referrer)</li>
<li>Content-Security-Policy (default-src ‘self’ https:; font-src ‘self’ https: data:; img-src ‘self’ https: data:; object-src ‘none’; script-src https:; style-src ‘self’ https: ‘unsafe-inline)’</li>
<li>X-Download-Options (noopen)</li>
<li>X-Permitted-Cross-Domain-Policies (none)</li>
</ul>
<p>要更改默认值，请在<code>spring.cloud.gateway.filter</code>中设置适当的属性。secure-headers名称空间。可以使用以下属性:</p>
<ul>
<li>xss-protection-header</li>
<li>strict-transport-security</li>
<li>x-frame-options</li>
<li>x-content-type-options</li>
<li>referrer-policy</li>
<li>content-security-policy</li>
<li>x-download-options</li>
<li>x-permitted-cross-domain-policies</li>
</ul>
<p>要禁用默认值，请设置<code>spring.cloud.gateway.filter.secure-headers</code>。禁用值以逗号分隔的属性。下面的例子展示了如何这样做:</p>
<pre><code class="language-properties">spring.cloud.gateway.filter.secure-headers.disable=x-frame-options,strict-transport-security
</code></pre>
<h3 id="SetPath">SetPath</h3>
<p>SetPath GatewayFilter工厂接受一个路径模板参数。它通过允许路径的模板段提供了一种操作请求路径的简单方法。这使用了Spring Framework中的URI模板。允许有多个匹配段。配置SetPath GatewayFilter的示例如下:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: setpath_route
        uri: https://example.org
        predicates:
        - Path=/red/{segment}
        filters:
        - SetPath=/{segment}
</code></pre>
<p>对于/red/blue的请求路径，这将在发出下游请求之前将路径设置为/blue。</p>
<h3 id="SetRequestHeader">SetRequestHeader</h3>
<p>SetRequestHeader GatewayFilter工厂接受名称和值参数。下面的清单配置了一个SetRequestHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: setrequestheader_route
        uri: https://example.org
        filters:
        - SetRequestHeader=X-Request-Red, Blue
</code></pre>
<p>这个GatewayFilter用给定的名称替换(而不是添加)所有头部。因此，如果下游服务器响应X-Request-Red:1234，则该响应将被替换为X-Request-Red:Blue，这就是下游服务将接收到的内容。</p>
<p>SetRequestHeader知道用于匹配路径或主机的URI变量。URI变量可以在值中使用，并在运行时展开。下面的例子配置了一个使用变量的SetRequestHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: setrequestheader_route
        uri: https://example.org
        predicates:
        - Host: {segment}.myhost.org
        filters:
        - SetRequestHeader=foo, bar-{segment}
</code></pre>
<h3 id="SetResponseHeader">SetResponseHeader</h3>
<p>SetResponseHeader GatewayFilter工厂接受名称和值参数。下面的清单配置了一个SetResponseHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: setresponseheader_route
        uri: https://example.org
        filters:
        - SetResponseHeader=X-Response-Red, Blue
</code></pre>
<p>这个GatewayFilter用给定的名称替换(而不是添加)所有头部。因此，如果下游服务器响应X-Response-Red:1234，则将其替换为X-Response-Red:Blue，这就是网关客户端将收到的内容。</p>
<p>SetResponseHeader知道用于匹配路径或主机的URI变量。URI变量可以在值中使用，并将在运行时展开。下面的例子配置了一个使用变量的SetResponseHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: setresponseheader_route
        uri: https://example.org
        predicates:
        - Host: {segment}.myhost.org
        filters:
        - SetResponseHeader=foo, bar-{segment}
</code></pre>
<h3 id="SetStatus">SetStatus</h3>
<p>SetStatus GatewayFilter工厂接受一个参数status。它必须是一个有效的Spring HttpStatus。它可以是整型值404或枚举的字符串表示形式:NOT_FOUND。下面的清单配置了一个SetStatus GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: setstatusstring_route
        uri: https://example.org
        filters:
        - SetStatus=UNAUTHORIZED
      - id: setstatusint_route
        uri: https://example.org
        filters:
        - SetStatus=401
</code></pre>
<p>在这两种情况下，响应的HTTP状态都设置为401。</p>
<p>您可以配置SetStatus GatewayFilter，以在响应的报头中返回代理请求的原始HTTP状态代码。如果配置了以下属性，报头将被添加到响应中:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      set-status:
        original-status-header-name: original-http-status
</code></pre>
<h2 id="StripPrefix">StripPrefix</h2>
<p>StripPrefix GatewayFilter工厂接受一个参数parts。parts参数表示在将请求发送到下游之前要从请求中剥离的路径中的部件数量。下面的清单配置了一个StripPrefix GatewayFilter:</p>
<p>StripPrefix 在我们当前请求中，通过<mark style="background: #FF5582A6;">规则值去掉某一部分地址</mark>，比如我们有一台服务中加入了一个前端<code>nacos-provider</code>想要通过这个去访问，我们在项目<code>cloud-alibaba-nacos-9001</code>中加入 <code>context-path</code></p>
<pre><code class="language-yml">server:
  port: 9001
  servlet:
    context-path: /nacos-provider
</code></pre>
<p>现在9001的访问路径变为<code>http://localhost:9001/nacos-provider/mxn/hello</code>，但是如果我们通过网关去访问路径就会变成<code>http://localhost:9006/mxn/nacos-provider/mxn/hello</code> 这个时候我们通过这个路径去访问是访问不成功的，想要解决这个方法，这个就用到了我们FIlter 中的 StripPrefix</p>
<pre><code class="language-yml">routes:  # 路由
  - id: nacos-provider #路由ID，没有固定要求，但是要保证唯一，建议配合服务名
    uri: lb://nacos-provider
    predicates: # 断言
      - Path=/mxn/** # 匹配对应地址
    filters:
      - StripPrefix=1 # 去掉地址中的第一部分
</code></pre>
<p><img src="/attachment/d321b232f581d437a35c7f27275c50ae.png" alt></p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: nameRoot
        uri: https://nameservice
        predicates:
        - Path=/name/**
        filters:
        - StripPrefix=2
</code></pre>
<p>当通过网关向/name/blue/red发出请求时，向nameservice发出的请求看起来像nameservice/red。</p>
<h3 id="Retry">Retry</h3>
<p>Retry GatewayFilter工厂支持以下参数:</p>
<ul>
<li><code>retries</code>:应该尝试的重试次数。</li>
<li><code>status</code>:应该重试的HTTP状态代码，用<code>org.springframework.http.HttpStatus</code>表示。</li>
<li><code>methods</code>:应该重试的HTTP方法，用<code>org.springframework.http.HttpMethod</code>表示。</li>
<li><code>series</code>:要重试的状态代码系列，由<code>org.springframework.http.HttpStatus.Series</code>表示。</li>
<li><code>exceptions</code>:抛出的应该重试的异常列表。</li>
<li><code>backoff</code>:配置的重试次数的指数级回退。在<code>firstBackoff * (factor ^ n)</code>的回退间隔后执行重试，其中n是迭代。如果配置了<code>maxBackoff</code>，则应用的最大回退限制为maxBackoff。如果<code>basedOnPreviousValue</code>为true，则使用prevBackoff * factor计算回退。</li>
</ul>
<p>如果启用重试筛选器，则配置以下默认值:</p>
<ul>
<li>retries: Three times</li>
<li>series: 5XX series</li>
<li>methods: GET method</li>
<li>exceptions: IOException and TimeoutException</li>
<li>backoff: disabled</li>
</ul>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: retry_test
        uri: http://localhost:8080/flakey
        predicates:
        - Host=*.retry.com
        filters:
        - name: Retry
          args:
            retries: 3
            statuses: BAD_GATEWAY
            methods: GET,POST
            backoff:
              firstBackoff: 10ms
              maxBackoff: 50ms
              factor: 2
              basedOnPreviousValue: false
</code></pre>
<p>可以使用单一的状态和方法添加简化的“快捷”符号。</p>
<p>下面两个例子是等价的:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: retry_route
        uri: https://example.org
        filters:
        - name: Retry
          args:
            retries: 3
            statuses: INTERNAL_SERVER_ERROR
            methods: GET
            backoff:
              firstBackoff: 10ms
              maxBackoff: 50ms
              factor: 2
              basedOnPreviousValue: false

      - id: retryshortcut_route
        uri: https://example.org
        filters:
        - Retry=3,INTERNAL_SERVER_ERROR,GET,10ms,50ms,2,false
</code></pre>
<h3 id="RequestSize">RequestSize</h3>
<p>当请求大小大于允许的限制时，RequestSize GatewayFilter工厂可以限制请求到达下游服务。过滤器接受一个maxSize参数。maxSize是一个DataSize类型，所以值可以定义为一个数字后面跟着一个可选的DataUnit后缀，如’KB’或’MB’。默认是’B’表示字节。它是以字节为单位定义的请求的允许大小限制。下面的清单配置了一个RequestSize GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: request_size_route
        uri: http://localhost:8080/upload
        predicates:
        - Path=/upload
        filters:
        - name: RequestSize
          args:
            maxSize: 5000000
</code></pre>
<p>RequestSize GatewayFilter工厂将响应状态设置为413 Payload Too Large，当请求因大小而被拒绝时，会附加一个报头errorMessage。下面的例子显示了这样一个errorMessage:</p>
<pre><code class="language-text">errorMessage : Request size is larger than permissible limit. Request size is 6.0 MB where permissible limit is 5.0 MB
</code></pre>
<h3 id="SetRequestHostHeader">SetRequestHostHeader</h3>
<p>在某些情况下，主机头可能需要被覆盖。在这种情况下，SetRequestHostHeader GatewayFilter工厂可以用指定的值替换现有的主机头。筛选器接受一个主机参数。下面的清单配置了SetRequestHostHeader GatewayFilter:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: set_request_host_header_route
        uri: http://localhost:8080/headers
        predicates:
        - Path=/headers
        filters:
        - name: SetRequestHostHeader
          args:
            host: example.org
</code></pre>
<p>SetRequestHostHeader GatewayFilter工厂用example.org替换主机头的值。</p>
<h3 id="ModifyRequestBody">ModifyRequestBody</h3>
<p>您可以使用ModifyRequestBody筛选器筛选器在请求正文被网关发送到下游之前修改它。</p>
<p>下面的列表显示了如何修改请求体GatewayFilter:</p>
<pre><code class="language-java">@Bean
public RouteLocator routes(RouteLocatorBuilder builder) {
    return builder.routes()
        .route("rewrite_request_obj", r -&gt; r.host("*.rewriterequestobj.org")
            .filters(f -&gt; f.prefixPath("/httpbin")
                .modifyRequestBody(String.class, Hello.class, MediaType.APPLICATION_JSON_VALUE,
                    (exchange, s) -&gt; return Mono.just(new Hello(s.toUpperCase())))).uri(uri))
        .build();
}

static class Hello {
    String message;

    public Hello() { }

    public Hello(String message) {
        this.message = message;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}
</code></pre>
<style>.admonition {
  margin: 1.5625em 0;
  padding: .6rem;
  overflow: hidden;
  font-size: 1.00rem;
  page-break-inside: avoid;
  border-left: .3rem solid #42b983;
  border-radius: .3rem;
  box-shadow: 0 0.1rem 0.4rem rgba(0,0,0,.05), 0 0 0.05rem rgba(0,0,0,.1);
  background-color: #fafafa;
}

p.admonition-title {
  position: relative;
  margin: -.6rem -.6rem .8em -.6rem !important;
  padding: .4rem .6rem .4rem 2.5rem;
  font-weight: 700;
  background-color:rgba(66, 185, 131, .1);
}

.admonition-title::before {
  position: absolute;
  top: .9rem;
  left: 1rem;
  width: 12px;
  height: 12px;
  background-color: #42b983;
  border-radius: 50%;
  content: ' ';
}

.info>.admonition-title, .todo>.admonition-title {
  background-color: rgba(0,184,212,.1);
}

.warning>.admonition-title, .attention>.admonition-title, .caution>.admonition-title {
  background-color: rgba(255,145,0,.1);
}

.failure>.admonition-title, .missing>.admonition-title, .fail>.admonition-title, .error>.admonition-title {
  background-color: rgba(255,82,82,.1);
}

.admonition.info, .admonition.todo {
  border-color: #00b8d4;
}

.admonition.warning, .admonition.attention, .admonition.caution {
  border-color: #ff9100;
}

.admonition.failure, .admonition.missing, .admonition.fail, .admonition.error {
  border-color: #ff5252;
}

.info>.admonition-title::before, .todo>.admonition-title::before {
  background-color: #00b8d4;
  border-radius: 50%;
}

.warning>.admonition-title::before, .attention>.admonition-title::before, .caution>.admonition-title::before {
  background-color: #ff9100;
  border-radius: 50%;
}

.failure>.admonition-title::before,.missing>.admonition-title::before,.fail>.admonition-title::before,.error>.admonition-title::before{
  background-color: #ff5252;;
  border-radius: 50%;
}

.admonition>:last-child {
  margin-bottom: 0 !important;
}
</style>
<div class="admonition info"><p class="admonition-title">如果请求没有正文，RewriteFilter将被传递为null。应该返回Mono.empty()来分配请求中缺少的主体。</p></div>
<h3 id="ModifyResponseBody">ModifyResponseBody</h3>
<p>在将响应体发送回客户端之前，可以使用ModifyResponseBody筛选器修改响应体。</p>
<p>下面的清单显示了如何修改响应体GatewayFilter:</p>
<pre><code class="language-java">@Bean
public RouteLocator routes(RouteLocatorBuilder builder) {
    return builder.routes()
        .route("rewrite_response_upper", r -&gt; r.host("*.rewriteresponseupper.org")
            .filters(f -&gt; f.prefixPath("/httpbin")
                .modifyResponseBody(String.class, String.class,
                    (exchange, s) -&gt; Mono.just(s.toUpperCase()))).uri(uri))
        .build();
}
</code></pre>
<h3 id="TokenRelay">TokenRelay</h3>
<p>在令牌中继中，OAuth2使用者充当客户端，将传入的令牌转发给传出的资源请求。使用者可以是纯客户端(如SSO应用程序)或资源服务器。</p>
<p>Spring Cloud Gateway可以将OAuth2访问令牌转发到它代理的下游服务。要把这个功能添加到gateway，你需要像这样添加TokenRelayGatewayFilterFactory:</p>
<pre><code class="language-java">@Bean
public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {
    return builder.routes()
            .route("resource", r -&gt; r.path("/resource")
                    .filters(f -&gt; f.tokenRelay())
                    .uri("http://localhost:9000"))
            .build();
}
</code></pre>
<p>或者</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: resource
        uri: http://localhost:9000
        predicates:
        - Path=/resource
        filters:
        - TokenRelay=
</code></pre>
<p>它将(除了让用户登录和获取令牌之外)将身份验证令牌传递到下游的服务(在本例中是/资源)。</p>
<p>要为Spring Cloud Gateway启用此功能，请添加以下依赖项</p>
<ul>
<li><code>org.springframework.boot:spring-boot-starter-oauth2-client</code></li>
</ul>
<style>.admonition {
  margin: 1.5625em 0;
  padding: .6rem;
  overflow: hidden;
  font-size: 1.00rem;
  page-break-inside: avoid;
  border-left: .3rem solid #42b983;
  border-radius: .3rem;
  box-shadow: 0 0.1rem 0.4rem rgba(0,0,0,.05), 0 0 0.05rem rgba(0,0,0,.1);
  background-color: #fafafa;
}

p.admonition-title {
  position: relative;
  margin: -.6rem -.6rem .8em -.6rem !important;
  padding: .4rem .6rem .4rem 2.5rem;
  font-weight: 700;
  background-color:rgba(66, 185, 131, .1);
}

.admonition-title::before {
  position: absolute;
  top: .9rem;
  left: 1rem;
  width: 12px;
  height: 12px;
  background-color: #42b983;
  border-radius: 50%;
  content: ' ';
}

.info>.admonition-title, .todo>.admonition-title {
  background-color: rgba(0,184,212,.1);
}

.warning>.admonition-title, .attention>.admonition-title, .caution>.admonition-title {
  background-color: rgba(255,145,0,.1);
}

.failure>.admonition-title, .missing>.admonition-title, .fail>.admonition-title, .error>.admonition-title {
  background-color: rgba(255,82,82,.1);
}

.admonition.info, .admonition.todo {
  border-color: #00b8d4;
}

.admonition.warning, .admonition.attention, .admonition.caution {
  border-color: #ff9100;
}

.admonition.failure, .admonition.missing, .admonition.fail, .admonition.error {
  border-color: #ff5252;
}

.info>.admonition-title::before, .todo>.admonition-title::before {
  background-color: #00b8d4;
  border-radius: 50%;
}

.warning>.admonition-title::before, .attention>.admonition-title::before, .caution>.admonition-title::before {
  background-color: #ff9100;
  border-radius: 50%;
}

.failure>.admonition-title::before,.missing>.admonition-title::before,.fail>.admonition-title::before,.error>.admonition-title::before{
  background-color: #ff5252;;
  border-radius: 50%;
}

.admonition>:last-child {
  margin-bottom: 0 !important;
}
</style>
<div class="admonition info"><p class="admonition-title">TokenRelayGatewayFilterFactory bean只会在适当的spring.security.oauth2.client。*属性的设置将触发ReactiveClientRegistrationRepository bean的创建。</p><pre><code>
```ad-info
TokenRelayGatewayFilterFactory使用的ReactiveOAuth2AuthorizedClientService的默认实现使用内存中的数据存储。如果需要更健壮的解决方案，则需要提供自己的ReactiveOAuth2AuthorizedClientService实现。</code></pre>
</div>
<h3 id="CacheRequestBody">CacheRequestBody</h3>
<p>有一定的情况需要阅读身体。由于请求体流只能读取一次，所以我们需要缓存请求体。您可以使用CacheRequestBody过滤器在请求正文发送到下游之前缓存请求正文，并从exchangagne属性获取请求正文。</p>
<p>下面的列表显示了如何缓存请求体GatewayFilter:</p>
<pre><code class="language-java">@Bean
public RouteLocator routes(RouteLocatorBuilder builder) {
    return builder.routes()
        .route("cache_request_body_route", r -&gt; r.path("/downstream/**")
            .filters(f -&gt; f.prefixPath("/httpbin")
                .cacheRequestBody(String.class).uri(uri))
        .build();
}
</code></pre>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
      - id: cache_request_body_route
        uri: lb://downstream
        predicates:
        - Path=/downstream/**
        filters:
        - name: CacheRequestBody
          args:
            bodyClass: java.lang.String
</code></pre>
<p>CacheRequestBody将提取请求正文并将其转换为正文类(例如<code>java.lang.body</code>)。字符串，在前面的例子中定义)。然后将其放入<code>ServerWebExchangeUtils.CACHED_REQUEST_BODY_ATTR</code>中定义的键<code>serverwebexchangeutils.getattributes()</code>中。</p>
<h3 id="JsonToGrpc">JsonToGrpc</h3>
<p>JSONToGRPCFilter GatewayFilter Factory将JSON有效负载转换为gRPC请求。</p>
<p>过滤器接受以下参数:</p>
<ul>
<li><code>protoDescriptor</code> 原型描述符文件。</li>
</ul>
<p>这个文件可以使用指定<code>--descriptor_set_out</code>标志的协议生成:</p>
<pre><code class="language-bash">protoc --proto_path=src/main/resources/proto/ \
--descriptor_set_out=src/main/resources/proto/hello.pb  \
src/main/resources/proto/hello.proto
</code></pre>
<ul>
<li><code>protoFile</code> 原型定义文件。</li>
<li><code>service</code> 将处理请求的服务的完全限定名称。</li>
<li><code>method</code> 服务中处理请求的方法名。</li>
</ul>
<pre><code class="language-java">@Bean
public RouteLocator routes(RouteLocatorBuilder builder) {
    return builder.routes()
            .route("json-grpc", r -&gt; r.path("/json/hello").filters(f -&gt; {
                String protoDescriptor = "file:src/main/proto/hello.pb";
                String protoFile = "file:src/main/proto/hello.proto";
                String service = "HelloService";
                String method = "hello";
                return f.jsonToGRPC(protoDescriptor, protoFile, service, method);
            }).uri(uri))
</code></pre>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      routes:
        - id: json-grpc
          uri: https://localhost:6565/testhello
          predicates:
            - Path=/json/**
          filters:
            - name: JsonToGrpc
              args:
                protoDescriptor: file:proto/hello.pb
                protoFile: file:proto/hello.proto
                service: com.example.grpcserver.hello.HelloService
                method: hello
</code></pre>
<p>当一个请求通过网关发送到<code>/json/hello</code>时，请求将使用hello中提供的定义进行转换。Proto，发送到<code>com.example.grpcserver.hello.HelloService/hello</code>，并将响应转换回JSON。</p>
<p>默认情况下，它将使用默认的TrustManagerFactory创建一个NettyChannel。但是，这个TrustManager可以通过创建一个GrpcSslConfigurer类型的bean来定制:</p>
<pre><code class="language-java">@Configuration
public class GRPCLocalConfiguration {
    @Bean
    public GRPCSSLContext sslContext() {
        TrustManager trustManager = trustAllCerts();
        return new GRPCSSLContext(trustManager);
    }
}
</code></pre>
<h3 id="Default">Default</h3>
<p>要添加一个过滤器并将其应用于所有路由，可以使用<code>spring.cloud.gateway.default-filters</code>。此属性接受一个筛选器列表。下面的清单定义了一组默认过滤器:</p>
<pre><code class="language-yml">spring:
  cloud:
    gateway:
      default-filters:
      - AddResponseHeader=X-Response-Default-Red, Default-Blue
      - PrefixPath=/httpbin
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/yu627482453">Bill Cipher</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yu627482453.github.io/module/spring-gateway/spring-gateway-gai-nian/spring-gateway-filter-guo-lu-qi/spring-gateway-ju-bu-guo-lu-qi/">https://yu627482453.github.io/module/spring-gateway/spring-gateway-gai-nian/spring-gateway-filter-guo-lu-qi/spring-gateway-ju-bu-guo-lu-qi/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yu627482453.github.io" target="_blank">蝶梦庄生</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%A1%8C%E5%8A%A8%E9%98%B6%E6%AE%B5-%E5%AE%8C%E6%88%90/">行动阶段/完成</a><a class="post-meta__tags" href="/tags/%E4%B8%BB%E9%A2%98%E5%9C%BA%E6%99%AF-%E7%BB%84%E4%BB%B6/">主题场景/组件</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0%E7%A9%BA%E9%97%B4-KnowladgeSpace-ProgramSpace-ModuleSpace/">笔记空间/KnowladgeSpace/ProgramSpace/ModuleSpace</a><a class="post-meta__tags" href="/tags/%E7%BB%86%E5%8C%96%E4%B8%BB%E9%A2%98-Module-SpringGateway/">细化主题/Module/SpringGateway</a></div><div class="post_share"><div class="social-share" data-image="https://api.yimian.xyz/img?type=moe" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/reward/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/reward/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/reward/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/module/spring-gateway/spring-gateway-gai-nian/spring-gateway-filter-guo-lu-qi/spring-gateway-quan-ju-guo-lu-qi/"><img class="prev-cover" src="https://api.yimian.xyz/img?type=moe" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【Spring Gateway】 全局过滤器</div></div></a></div><div class="next-post pull-right"><a href="/module/spring-gateway/spring-gateway-ji-chu/spring-gateway-pei-zhi/"><img class="next-cover" src="https://api.yimian.xyz/img?type=moe" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【Spring Gateway】 配置</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/module/spring-gateway/spring-gateway/" title="Spring Gateway"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-14</div><div class="title">Spring Gateway</div></div></a></div><div><a href="/module/spring-gateway/spring-gateway-ji-chu/spring-gateway-ji-chu/" title="【Spring Gateway】 基础"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-14</div><div class="title">【Spring Gateway】 基础</div></div></a></div><div><a href="/module/spring-gateway/spring-gateway-ji-chu/spring-gateway-jian-jie/" title="【Spring Gateway】 简介"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-13</div><div class="title">【Spring Gateway】 简介</div></div></a></div><div><a href="/module/spring-gateway/spring-gateway-ji-chu/spring-gateway-pei-zhi/" title="【Spring Gateway】 配置"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-14</div><div class="title">【Spring Gateway】 配置</div></div></a></div><div><a href="/module/spring-gateway/spring-gateway-ji-chu/spring-gateway-bei-jing/" title="【Spring Gateway】背景"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-13</div><div class="title">【Spring Gateway】背景</div></div></a></div><div><a href="/module/spring-gateway/spring-gateway-pei-zhi/spring-gateway-cors-configuration/" title="【Spring Gateway】 CORS Configuration"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-14</div><div class="title">【Spring Gateway】 CORS Configuration</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Bill Cipher</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">600</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">147</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">21</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yu627482453"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/yu627482453" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/627482453@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">【Spring Gateway】 局部过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Metadata-561"><span class="toc-number">1.1.</span> <span class="toc-text">Metadata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90Spring-Gateway%E3%80%91-%E5%B1%80%E9%83%A8%E8%BF%87%E6%BB%A4%E5%99%A8-2"><span class="toc-number">1.2.</span> <span class="toc-text">【Spring Gateway】 局部过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AddRequestHeader"><span class="toc-number">1.2.1.</span> <span class="toc-text">AddRequestHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AddRequestParameter"><span class="toc-number">1.2.2.</span> <span class="toc-text">AddRequestParameter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AddResponseHeader"><span class="toc-number">1.2.3.</span> <span class="toc-text">AddResponseHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DedupeResponseHeader"><span class="toc-number">1.2.4.</span> <span class="toc-text">DedupeResponseHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CircuitBreaker"><span class="toc-number">1.2.5.</span> <span class="toc-text">CircuitBreaker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FallbackHeaders"><span class="toc-number">1.2.6.</span> <span class="toc-text">FallbackHeaders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MapRequestHeader"><span class="toc-number">1.2.7.</span> <span class="toc-text">MapRequestHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PrefixPath"><span class="toc-number">1.2.8.</span> <span class="toc-text">PrefixPath</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PreserveHostHeader"><span class="toc-number">1.2.9.</span> <span class="toc-text">PreserveHostHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestRateLimiter"><span class="toc-number">1.2.10.</span> <span class="toc-text">RequestRateLimiter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Redis-RateLimiter"><span class="toc-number">1.2.10.1.</span> <span class="toc-text">The Redis RateLimiter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RedirectTo"><span class="toc-number">1.2.11.</span> <span class="toc-text">RedirectTo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RemoveRequestHeader"><span class="toc-number">1.2.12.</span> <span class="toc-text">RemoveRequestHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RemoveResponseHeader"><span class="toc-number">1.2.13.</span> <span class="toc-text">RemoveResponseHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RemoveRequestParameter"><span class="toc-number">1.2.14.</span> <span class="toc-text">RemoveRequestParameter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestHeaderSize"><span class="toc-number">1.2.15.</span> <span class="toc-text">RequestHeaderSize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RewritePath"><span class="toc-number">1.2.16.</span> <span class="toc-text">RewritePath</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RewriteLocationResponseHeader"><span class="toc-number">1.2.17.</span> <span class="toc-text">RewriteLocationResponseHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RewriteResponseHeader"><span class="toc-number">1.2.18.</span> <span class="toc-text">RewriteResponseHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SaveSession"><span class="toc-number">1.2.19.</span> <span class="toc-text">SaveSession</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SecureHeaders"><span class="toc-number">1.2.20.</span> <span class="toc-text">SecureHeaders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetPath"><span class="toc-number">1.2.21.</span> <span class="toc-text">SetPath</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetRequestHeader"><span class="toc-number">1.2.22.</span> <span class="toc-text">SetRequestHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetResponseHeader"><span class="toc-number">1.2.23.</span> <span class="toc-text">SetResponseHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetStatus"><span class="toc-number">1.2.24.</span> <span class="toc-text">SetStatus</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#StripPrefix"><span class="toc-number">1.3.</span> <span class="toc-text">StripPrefix</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Retry"><span class="toc-number">1.3.1.</span> <span class="toc-text">Retry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestSize"><span class="toc-number">1.3.2.</span> <span class="toc-text">RequestSize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetRequestHostHeader"><span class="toc-number">1.3.3.</span> <span class="toc-text">SetRequestHostHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModifyRequestBody"><span class="toc-number">1.3.4.</span> <span class="toc-text">ModifyRequestBody</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModifyResponseBody"><span class="toc-number">1.3.5.</span> <span class="toc-text">ModifyResponseBody</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TokenRelay"><span class="toc-number">1.3.6.</span> <span class="toc-text">TokenRelay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CacheRequestBody"><span class="toc-number">1.3.7.</span> <span class="toc-text">CacheRequestBody</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonToGrpc"><span class="toc-number">1.3.8.</span> <span class="toc-text">JsonToGrpc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Default"><span class="toc-number">1.3.9.</span> <span class="toc-text">Default</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/module/flowable/flowable-zhuan-lan/flowable-zhuan-lan/" title="无题"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/module/flowable/flowable-zhuan-lan/flowable-zhuan-lan/" title="无题">无题</a><time datetime="2023-07-15T09:45:06.401Z" title="发表于 2023-07-15 17:45:06">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/module/consul/part/consul-tong-yong-pei-zhi-shu-xing/" title="无题"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/module/consul/part/consul-tong-yong-pei-zhi-shu-xing/" title="无题">无题</a><time datetime="2023-07-15T09:44:38.408Z" title="发表于 2023-07-15 17:44:38">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/java/java-duo-xian-cheng-bing-fa/java-duo-xian-cheng-bing-fa-xian-cheng/java-duo-xian-cheng-bing-fa-xian-cheng/" title="【Java 多线程并发】 线程"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Java 多线程并发】 线程"/></a><div class="content"><a class="title" href="/java/java-duo-xian-cheng-bing-fa/java-duo-xian-cheng-bing-fa-xian-cheng/java-duo-xian-cheng-bing-fa-xian-cheng/" title="【Java 多线程并发】 线程">【Java 多线程并发】 线程</a><time datetime="2023-07-10T06:15:00.000Z" title="发表于 2023-07-10 14:15:00">2023-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/java/java-jvm/java-jvm-nei-cun-guan-li/java-jvm-zhi-jie-nei-cun/" title="【Java JVM】 直接内存"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Java JVM】 直接内存"/></a><div class="content"><a class="title" href="/java/java-jvm/java-jvm-nei-cun-guan-li/java-jvm-zhi-jie-nei-cun/" title="【Java JVM】 直接内存">【Java JVM】 直接内存</a><time datetime="2023-07-10T00:00:00.000Z" title="发表于 2023-07-10 08:00:00">2023-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/database/redis/redis-chong-dian-gong-neng/redis-pai-xu/" title="【Redis】 排序"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Redis】 排序"/></a><div class="content"><a class="title" href="/database/redis/redis-chong-dian-gong-neng/redis-pai-xu/" title="【Redis】 排序">【Redis】 排序</a><time datetime="2023-07-09T06:07:00.000Z" title="发表于 2023-07-09 14:07:00">2023-07-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Bill Cipher</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'c61a274b6f5aa26a58f6',
      clientSecret: '485a7761d321c8dcc5cae05d7256be9fb196d94a',
      repo: 'yu627482453.github.io',
      owner: 'yu627482453',
      admin: ['yu627482453'],
      id: '66554df671fcee76915bd42ad53f5f54',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>