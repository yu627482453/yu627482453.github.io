<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>【OpenFeign】 集成 Hystrix 基本工作原理 | 蝶梦庄生</title><meta name="keywords" content="OpenFeign"><meta name="author" content="Bill Cipher"><meta name="copyright" content="Bill Cipher"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="【OpenFeign】 集成 Hystrix 基本工作原理">
<meta property="og:type" content="article">
<meta property="og:title" content="【OpenFeign】 集成 Hystrix 基本工作原理">
<meta property="og:url" content="https://yu627482453.github.io/module/openfeign/openfeign-sheng-tai/openfeign-ji-cheng-hystrix/openfeign-ji-cheng-hystrix-ji-ben-gong-zuo-yuan-li/index.html">
<meta property="og:site_name" content="蝶梦庄生">
<meta property="og:description" content="【OpenFeign】 集成 Hystrix 基本工作原理">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://api.yimian.xyz/img?type=moe">
<meta property="article:published_time" content="2023-01-02T11:16:00.000Z">
<meta property="article:modified_time" content="2023-01-02T11:16:00.000Z">
<meta property="article:author" content="Bill Cipher">
<meta property="article:tag" content="行动阶段&#x2F;完成">
<meta property="article:tag" content="主题场景&#x2F;组件">
<meta property="article:tag" content="笔记空间&#x2F;KnowladgeSpace&#x2F;ProgramSpace&#x2F;ModuleSpace">
<meta property="article:tag" content="细化主题&#x2F;Module&#x2F;OpenFeign&#x2F;生态&#x2F;Hystrix">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://api.yimian.xyz/img?type=moe"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://yu627482453.github.io/module/openfeign/openfeign-sheng-tai/openfeign-ji-cheng-hystrix/openfeign-ji-cheng-hystrix-ji-ben-gong-zuo-yuan-li/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Bill Cipher","link":"链接: ","source":"来源: 蝶梦庄生","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【OpenFeign】 集成 Hystrix 基本工作原理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-02 19:16:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">574</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">122</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://api.yimian.xyz/img?type=moe')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">蝶梦庄生</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【OpenFeign】 集成 Hystrix 基本工作原理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-02T11:16:00.000Z" title="发表于 2023-01-02 19:16:00">2023-01-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-02T11:16:00.000Z" title="更新于 2023-01-02 19:16:00">2023-01-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/OpenFeign/">OpenFeign</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【OpenFeign】 集成 Hystrix 基本工作原理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>【OpenFeign】 集成 Hystrix 基本工作原理</h1>
<h2 id="Metadata-539">Metadata</h2>
<pre><code class="language-yml">title: 【OpenFeign】 集成 Hystrix 基本工作原理
date: 2023-01-02 19:16
tags:
  - 行动阶段/完成
  - 主题场景/组件
  - 笔记空间/KnowladgeSpace/ProgramSpace/ModuleSpace
  - 细化主题/Module/OpenFeign/生态/Hystrix
categories:
  - OpenFeign
keywords:
  - OpenFeign
description: 【OpenFeign】 集成 Hystrix 基本工作原理
</code></pre>
<h2 id="【OpenFeign】-集成-Hystrix-基本工作原理">【OpenFeign】 集成 Hystrix 基本工作原理</h2>
<p>下图显示了通过 Hystrix 向服务提供者发出请求时会发生什么：</p>
<p><img src="https://img-blog.csdnimg.cn/554ee6c480284c13b33be47f010bb04a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_20,color_FFFFFF,t_70,g_se,x_16" alt></p>
<p>以下部分将更详细地解释此流程：</p>
<h2 id="1-构造一个-HystrixCommand-或-HystrixObservableCommand-对象">1. 构造一个 HystrixCommand 或 HystrixObservableCommand 对象</h2>
<p>第一步是构造一个<code>HystrixCommand</code>或<code>HystrixObservableCommand</code>对象来表示对服务提供者发出的请求。向构造函数传递发出请求时需要的参数。</p>
<p><code>HystrixCommand</code>如果期望返回单个响应，则构造一个对象。例如：</p>
<pre><code class="language-java">HystrixCommand command = new HystrixCommand(arg1, arg2);
</code></pre>
<p><code>HystrixObservableCommand</code>如果期望返回一个发出响应的 <code>Observable</code>，则构造一个对象。例如：</p>
<pre><code class="language-java">HystrixObservableCommand command = new HystrixObservableCommand(arg1, arg2);
</code></pre>
<h2 id="2-执行命令">2. 执行命令</h2>
<p>有四种方法可以执行命令，通过使用 Hystrix 命令对象的以下四种方法之一（前两种仅适用于简单<code>HystrixCommand</code>对象，不适用于<code>HystrixObservableCommand</code>）：</p>
<ul>
<li>execute() — 阻塞，返回接收到的单个响应（或在发生错误时抛出异常）</li>
<li>queue()— 返回<code>Future</code>，您可以使用它获取单个响应</li>
<li>observe()— 订阅<code>Observable</code>表示来自依赖项的响应 ，并返回一个<code>Observable</code></li>
<li>toObservable()— 返回一个<code>Observable</code>，当您订阅它时，将执行 Hystrix 命令并发出它的响应</li>
</ul>
<pre><code class="language-java">K             value   = command.execute();
Future&lt;K&gt;     fValue  = command.queue();
Observable&lt;K&gt; ohValue = command.observe();          //热可观察
Observable&lt;K&gt; ocValue = command.toObservable();     //冷可观察
</code></pre>
<p>同步调用执行的<code>execute()</code>、<code>queue().get(). queue()</code>方法最终调用是的<code>toObservable().toBlocking().toFuture()</code>，也就是说，最终每个<code>HystrixCommand</code>都由一个<code>Observable</code>实现支持。</p>
<h2 id="3-响应是否被缓存？">3. 响应是否被缓存？</h2>
<p>如果该命令启用了请求缓存，并且缓存中有对请求的响应，则缓存的<code>Observable</code>响应将立即返回。（请参阅下面的 “请求缓存”。）</p>
<h2 id="4-断路器是否开启？">4. 断路器是否开启？</h2>
<p>当您执行命令时，<code>Hystrix</code> 会检查断路器以查看电路是否打开。</p>
<p>如果电路打开（或 “跳闸”），则 <code>Hystrix</code>不会执行命令，但会将流程路由到<code>(8)</code>Get the Fallback。</p>
<p>如果电路闭合，则流程进行到 <code>(5)</code>以检查是否有容量可用于运行命令。</p>
<h2 id="5-线程池-信号量是否已满？">5. 线程池 / <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%BF%A1%E5%8F%B7%E9%87%8F&amp;spm=1001.2101.3001.7020">信号量</a>是否已满？</h2>
<p>如果与命令关联的线程池或信号量 (如果未在线程中运行）已满，则 Hystrix 将不执行命令，但会立即将流路由到 <code>(8)</code>Get the Fallback。</p>
<h2 id="6-HystrixObservableCommand-construct-或-HystrixCommand-run">6.HystrixObservableCommand.construct() 或 HystrixCommand.run()</h2>
<p>在这里，Hystrix 通过以下方法之一调用请求：</p>
<ul>
<li>HystrixCommand.run() — 返回单个响应或抛出异常</li>
<li>HystrixObservableCommand.construct()— 返回一个发出响应或发送 onError 通知的<code>Observable</code></li>
</ul>
<p>如果<code>run()、orconstruct()</code>方法超过了命令的超时时间，线程将抛出一个<code>TimeoutException</code>（或者一个单独的计时器线程，如果命令本身没有在它自己的线程中运行）。在这种情况下，Hystrix 通过 <code>（8 ）</code>获取 <code>Fallback</code>。</p>
<p>没有办法强制潜在线程停止工作，Hystrix 在 JVM 上可以做的就是抛出一个<code>InterruptedException</code>。如果 Hystrix 包裹的工作不考虑<code>InterruptedExceptions</code>，Hystrix 线程池中的线程将继续工作，尽管客户端已经收到了 <code>TimeoutException</code>。这种行为可能会使 Hystrix 线程池饱和，尽管负载是 “正确卸载” 的。大多数 Java HTTP 客户端库不解释 <code>InterruptedExceptions</code>。因此，请确保在 HTTP 客户端上正确配置连接和读 / 写超时。</p>
<p>如果该命令没有抛出任何异常并且它返回了响应，Hystrix 会在执行一些日志记录和指标报告后返回此响应。</p>
<h2 id="7-计算断路器健康状态">7. 计算断路器健康状态</h2>
<p>Hystrix 向断路器报告成功、失败、拒绝和超时，断路器维护一组滚动的计数器来计算统计信息。</p>
<p>它使用这些统计数据来确定电路何时应该 “跳闸”，此时它会短路任何后续请求，直到经过恢复期，然后在首先检查某些健康检查后再次关闭电路。</p>
<h2 id="8-获取降级">8. 获取降级</h2>
<p>当<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&amp;spm=1001.2101.3001.7020">命令执行</a>失败时，Hystrix 会尝试恢复到您的降级：</p>
<ul>
<li>当<code>(6)</code>引发异常时</li>
<li>于电路打开 <code>(4)</code>而导致命令短路时</li>
<li>当命令的线程池和队列或信号量达到容量<code>(5.)</code></li>
<li>当命令超过其超时时间时。</li>
</ul>
<p>降级可以从内存缓存或其他静态逻辑提供通用响应，而无需任何网络依赖。如果您必须在回退中使用网络调用，您应该通过另一个<code>HystrixCommand</code>或<code>HystrixObservableCommand</code>。</p>
<p>如果<code>fallback</code>方法返回一个响应，那么 Hystrix 将这个响应返回给调用者。对于<code>HystrixCommand.getFallback()</code>，它将返回一个<code>Observable</code> ，该 <code>Observable</code>发出从该方法返回的值。在这种情况下，<code>HystrixObservableCommand.resumeWithFallback()</code>它将返回从方法返回的相同 <code>Observable</code>。</p>
<p>如果你没有为你的 Hystrix 命令实现一个回退方法，或者如果回退本身抛出一个异常，Hystrix 仍然返回一个 <code>Observable</code>，但它什么都不发出并立即终止并发出 onError 通知。正是通过这个 onError 通知，导致命令失败的异常被传回给调用者。（实施可能失败的回退实现是一种糟糕的做法。您应该实施回退，使其不执行任何可能失败的逻辑。）</p>
<p>失败或不存在的回退的结果将根据您调用 Hystrix 命令的方式而有所不同：</p>
<ul>
<li>execute() — 抛出异常</li>
<li>queue()— 成功返回 Future，但是如果<code>Future.get()</code>调用它的方法会抛出异常</li>
<li>observe()— 返回一个<code>Observable</code>，当您订阅它时，将通过调用订阅者的 onError 方法立即终止</li>
<li>toObservable()— 返回一个 Observable，当您订阅它时，将通过调用订阅者的 onError 方法终止</li>
</ul>
<h2 id="9-返回成功响应">9. 返回成功响应</h2>
<p>如果 Hystrix 命令成功，它将以根据您在上述步骤 2 中调用命令的方式，在<code>Observable</code>返回给您之前可能会对其进行转换：</p>
<p><img src="https://img-blog.csdnimg.cn/920a457c9f974939b8859bcf583f19ab.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_20,color_FFFFFF,t_70,g_se,x_16" alt></p>
<p>下图显示了<code>HystrixCommandorHystrixObservableCommand</code>与<code>HystrixCircuitBreaker</code>交互及其逻辑和决策流程，包括计数器在断路器中的行为方式。</p>
<p><img src="https://img-blog.csdnimg.cn/6ba5c3029fa6413a8aee3d00396fd0ff.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_20,color_FFFFFF,t_70,g_se,x_16" alt></p>
<p>电路开闭发生的具体方式如下：</p>
<ul>
<li>假设整个电路的请求量满足某个阈值 (HystrixCommandProperties.circuitBreakerRequestVolumeThreshold())…</li>
<li>并假设错误百分比超过阈值错误百分比（HystrixCommandProperties.circuitBreakerErrorThresholdPercentage()）…</li>
<li>然后断路器从 转变<code>CLOSED</code>为<code>OPEN</code>。</li>
<li>当它打开时，它会将针对该断路器的所有请求短路。</li>
<li>一段时间后（HystrixCommandProperties.circuitBreakerSleepWindowInMilliseconds()），下一个请求被允许通过（这是 HALF-OPEN 状态）。如果请求失败，断路器将<code>OPEN</code>在睡眠窗口期间返回状态。如果请求成功，断路器转换到 1. 中<code>CLOSED</code>的逻辑再次接管。</li>
</ul>
<p>Hystrix 使用船舱隔离模式来隔离彼此的依赖关系并限制对其中任何一个的并发访问。</p>
<p><img src="https://img-blog.csdnimg.cn/6dd2960a87ce4d56bd377b16c3fd6872.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_20,color_FFFFFF,t_70,g_se,x_16" alt></p>
<h2 id="线程和线程池">线程和线程池</h2>
<p>客户端（库、网络调用等）在不同的线程上执行。这将它们与调用线程（Tomcat 线程池）隔离开来，以便调用者可以 “离开” 耗时过长的依赖调用。</p>
<p>Hystrix 使用单独的、每个依赖项的线程池作为约束任何给定依赖项的一种方式，因此底层执行的延迟将仅使该池中的可用线程饱和。</p>
<p><img src="https://img-blog.csdnimg.cn/1a669b0fac4b48be92ff2af881a63a76.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_20,color_FFFFFF,t_70,g_se,x_16" alt></p>
<p>您可以在不使用线程池的情况下防止失败，但这需要受信任的客户端非常快速地失败（网络连接 / 读取超时和重试配置）并始终表现良好。</p>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Netflix&amp;spm=1001.2101.3001.7020">Netflix</a> 在其 Hystrix 的设计中，出于多种原因选择使用线程和线程池来实现隔离，包括：</p>
<ul>
<li>
<p>许多应用程序针对由许多不同团队开发的数十种不同服务执行数十种（有时甚至超过 100 次）不同的后端服务调用。</p>
</li>
<li>
<p>每个服务都提供自己的客户端库。</p>
</li>
<li>
<p>客户端库一直在变化。</p>
</li>
<li>
<p>客户端库逻辑可以更改以添加新的网络调用。</p>
</li>
<li>
<p>客户端库可以包含诸如重试、数据解析、缓存（内存中或跨网络）和其他此类行为之类的逻辑。</p>
</li>
<li>
<p>客户端库往往是 “黑匣子”——对于用户来说，实现细节、网络访问模式、配置默认值等都是不透明的。</p>
</li>
<li>
<p>在几次实际的生产中断中，决定是 “哦，有些东西发生了变化，应该调整属性” 或“客户端库改变了它的行为”。</p>
</li>
<li>
<p>即使客户端本身没有变化，服务本身也会发生变化，这会影响性能特征，进而导致客户端配置无效。</p>
</li>
<li>
<p>传递依赖可能会引入其他未预期且可能未正确配置的客户端库。</p>
</li>
<li>
<p>大多数网络访问是同步执行的。</p>
</li>
<li>
<p>失败和延迟也可能发生在客户端代码中，而不仅仅是网络调用。</p>
<p><img src="https://img-blog.csdnimg.cn/f6ab1591c8884a4195e9f3c97d00fa6b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_20,color_FFFFFF,t_70,g_se,x_16" alt></p>
</li>
</ul>
<h2 id="线程池的好处">线程池的好处</h2>
<p>通过自己的线程池中的线程进行隔离的好处是：</p>
<ul>
<li>该应用程序完全不受失控客户端库的影响。给定依赖库的池可以填满，而不会影响应用程序的其余部分。</li>
<li>该应用程序可以接受风险低得多的新客户端库。如果出现问题，它会与库隔离，不会影响其他所有内容。</li>
<li>当失败的客户端再次恢复健康时，线程池将清理干净，应用程序立即恢复健康的性能，而不是整个 Tomcat 容器不堪重负时的长时间恢复。</li>
<li>如果客户端库配置错误，线程池的健康状况将很快证明这一点（通过增加错误、延迟、超时、拒绝等），您可以在不影响应用程序功能的情况下处理它（通常通过动态属性实时处理） .</li>
<li>如果客户端服务更改了性能特征（这种情况经常发生足以成为一个问题），进而导致需要调整属性（增加 / 减少超时、更改重试等），这再次通过线程池指标（错误、延迟）变得可见、超时、拒绝），并且可以在不影响其他客户端、请求或用户的情况下进行处理。</li>
<li>除了隔离优势之外，拥有专用线程池还提供了内置的并发性，可用于在同步客户端库之上构建异步外观（类似于 Netflix API 如何在 Hystrix 命令之上构建反应式、完全异步的 Java API） .</li>
<li>简而言之，线程池提供的隔离允许客户端库和子系统性能特征的不断变化和动态组合得到妥善处理，而不会导致中断。</li>
</ul>
<p>** 注意：** 尽管单独的线程提供了隔离，但您的底层客户端代码也应该有超时和 / 或响应线程中断，因此它不会无限期地阻塞并使 Hystrix 线程池饱和。</p>
<h2 id="线程池的缺点">线程池的缺点</h2>
<p>线程池的主要缺点是它们增加了计算开销。每个命令执行都涉及在单独线程上运行命令所涉及的排队、调度和上下文切换。</p>
<p>Netflix 在设计这个系统时，决定接受这种开销的成本以换取它提供的好处，并认为它足够小，不会对成本或性能产生重大影响。</p>
<h2 id="线程成本">线程成本</h2>
<p>Hystrix 测量在子线程上执行 construct()orrun() 方法时的延迟以及在父线程上的总端到端时间。通过这种方式，您可以看到 Hystrix 开销（线程、指标、日志记录、断路器等）的成本。</p>
<p>Netflix API 每天使用线程隔离处理 10+ 亿次 Hystrix 命令执行。每个 API 实例有 40 多个线程池，每个线程池有 5-20 个线程（大多数设置为 10）。</p>
<p>下图表示 HystrixCommand 在单个 API 实例上以每秒 60 个请求的速度执行（每台服务器每秒大约 350 个总线程执行）：</p>
<p><img src="https://img-blog.csdnimg.cn/4110b696c5e44c42a8af6cf71e314ae4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_20,color_FFFFFF,t_70,g_se,x_16" alt></p>
<p>在中位数（或更低），拥有一个单独的线程是没有成本的。</p>
<p>在第 90 个百分位，有一个单独的线程需要 3 毫秒的成本。</p>
<p>在第 99 个百分位，有一个单独的线程需要 9 毫秒。但是请注意，成本的增加远小于单独线程（网络请求）的执行时间增加，后者从 2 跳到 28，而成本从 0 跳到 9。</p>
<p>此开销在 90 个百分和电路，诸如这些较高已被认为对大多数 Netflix 的用例的弹性实现的益处可以接受的。</p>
<p>对于包装非常低延迟请求的电路（例如那些主要命中内存缓存的请求），开销可能太高，在这种情况下，您可以使用另一种方法，例如可尝试的信号量，虽然它们不允许超时，无需开销即可提供大部分弹性优势。然而，一般来说，开销足够小，以至于 Netflix 在实践中通常更喜欢单独线程的隔离优势而不是此类技术。</p>
<p>您可以使用信号量（或计数器）来限制对任何给定依赖项的并发调用数，而不是使用线程池 / 队列大小。这允许 Hystrix 在不使用线程池的情况下减轻负载，但它不允许超时和走开。如果您信任客户端并且只想要减载，则可以使用这种方法。</p>
<p><code>HystrixCommand</code>、<code>HystrixObservableCommand</code>在两个地方支持信号量：</p>
<ul>
<li>降级：当 Hystrix 检索后备时，它总是在调用 Tomcat 线程上这样做。</li>
<li>执行：如果你设置这个属性 execution.isolation.strategy，SEMAPHORE 那么 Hystrix 将使用信号量而不是线程来限制调用命令的并发父线程的数量。</li>
</ul>
<p>您可以通过定义可以执行多少并发线程的动态属性来配置信号量的这两种用途。您应该使用与调整线程池大小时使用的类似计算来调整它们的大小（在亚毫秒时间内返回的内存调用可以在信号量仅为 1 或 2 的情况下执行超过 5000rps … 但默认值为 10）。</p>
<p>注意：如果一个依赖被信号量隔离然后变成潜在的，父线程将保持阻塞，直到底层网络调用超时。</p>
<p>一旦达到限制，信号量拒绝将开始，但填充信号量的线程不能走开。</p>
<p>您可以在<code>HystrixCommand</code>前面加上一个请求折叠器（HystrixCollapser 是抽象父级），您可以使用它将多个请求折叠到一个后端依赖调用中。</p>
<p>下图显示了两种情况下的线程数和网络连接数：首先没有请求折叠，然后请求折叠（假设所有连接在很短的时间窗口内 “并发”，在本例中为 10 毫秒）。</p>
<p><img src="https://img-blog.csdnimg.cn/ebab84fd38ff4d178bde2b2cb09957c0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_19,color_FFFFFF,t_70,g_se,x_16" alt></p>
<p><strong>为什么使用请求折叠？</strong></p>
<p>使用请求折叠来减少执行并发 HystrixCommand 执行所需的线程数和网络连接数。请求折叠以自动方式执行此操作，不会强制代码库的所有开发人员协调手动批处理请求。</p>
<p><strong>全局上下文（跨所有 Tomcat 线程）</strong></p>
<p>理想的折叠类型是在全局应用程序级别完成的，因此来自任何 Tomcat 线程上的任何用户的请求都可以折叠在一起。</p>
<p>例如，如果您将 a 配置 HystrixCommand 为支持任何用户对检索电影评级的依赖项的请求进行批处理，那么当同一 JVM 中的任何用户线程发出此类请求时，Hystrix 会将其请求与任何其他请求一起添加到同一个折叠的网络通话。</p>
<p>请注意，折叠器会将单个 HystrixRequestContext 对象传递给折叠的网络调用，因此下游系统必须处理这种情况才能成为有效的选项。</p>
<p><strong>用户请求上下文（单个 Tomcat 线程）</strong></p>
<p>如果您将 a 配置 HystrixCommand 为仅处理单个用户的批处理请求，则 Hystrix 可以折叠来自单个 Tomcat 线程（请求）的请求。</p>
<p>例如，如果用户想要为 300 个视频对象加载书签，而不是执行 300 个网络调用，Hystrix 可以将它们全部合并为一个。</p>
<p><strong>对象建模和代码复杂性</strong></p>
<p>有时，当您创建对对象的消费者具有逻辑意义的对象模型时，这与对象生产者的有效资源利用不匹配。</p>
<p>例如，给定一个包含 300 个视频对象的列表，遍历它们并调用 getSomeAttribute() 每个对象是一个明显的对象模型，但如果实施得天真，可能会导致 300 个网络调用都在几毫秒内完成（并且很可能会导致资源饱和）。</p>
<p>您可以通过手动方式处理此问题，例如在允许用户调用之前 getSomeAttribute()，要求他们声明他们想要获取哪些视频对象的属性，以便它们都可以被预取。</p>
<p>或者，您可以划分对象模型，以便用户必须从一个地方获取视频列表，然后从其他地方请求该视频列表的属性。</p>
<p>这些方法可能会导致笨拙的 API 和对象模型与心智模型和使用模式不匹配。当多个开发人员在代码库上工作时，它们还可能导致简单的错误和效率低下，因为为一个用例完成的优化可能会被另一个用例的实现和代码中的新路径破坏。</p>
<p>通过将折叠逻辑下推到 Hystrix 层，您如何创建对象模型、以什​​么顺序进行调用、或者不同的开发人员是否知道正在完成甚至需要完成的优化都无关紧要。</p>
<p>该 getSomeAttribute() 方法可以放在最适合的地方，并以适合使用模式的任何方式调用，并且折叠器将自动将调用批处理到时间窗口中。</p>
<p><strong>请求崩溃的成本是多少？</strong></p>
<p>启用请求折叠的代价是在执行实际命令之前增加了延迟。最大成本是批处理窗口的大小。</p>
<p>如果您有一个执行中位数为 5 毫秒的命令，以及一个 10 毫秒的批处理窗口，那么在最坏的情况下执行时间可能会变为 15 毫秒。通常，请求不会恰好在窗口打开时被提交到窗口，因此中值惩罚是窗口时间的一半，在本例中为 5 毫秒。</p>
<p>该成本是否值得的确定取决于正在执行的命令。高延迟命令不会因少量额外的平均延迟而受到太大影响。此外，给定命令的并发量是关键：如果要批处理的请求很少超过 1 或 2 个，那么付出代价是没有意义的。事实上，在单线程顺序迭代中，崩溃将是一个主要的性能瓶颈，因为每次迭代都会等待 10 毫秒的批处理窗口时间。</p>
<p>然而，如果一个特定的命令被大量并发使用并且可以同时批处理数十甚至数百个调用，那么成本通常远远超过所获得的吞吐量增加，因为 Hystrix 减少了它所需的线程数和网络连接数依赖关系。</p>
<p>折叠器流</p>
<p><img src="https://img-blog.csdnimg.cn/39a02aa36bc3472eb2fe91f5010f0acb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_19,color_FFFFFF,t_70,g_se,x_16" alt></p>
<p><code>HystrixCommand</code>、<code>HystrixObservableCommand</code>实现可以定义一个缓存键，然后用于以并发感知的方式在请求上下文中对调用进行重复数据删除。</p>
<p>这是一个示例流程，涉及 HTTP 请求生命周期和在该请求中工作的两个线程：</p>
<p><img src="https://img-blog.csdnimg.cn/16ff4908ea2549c9820bf79c0438ba38.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNDM0Mzc4NzQ=,size_19,color_FFFFFF,t_70,g_se,x_16" alt></p>
<p>请求缓存的好处是：</p>
<ul>
<li>不同的代码路径可以执行 Hystrix 命令，而不用担心重复工作。</li>
<li>这在许多开发人员正在实现不同功能的大型代码库中特别有用。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/yu627482453">Bill Cipher</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yu627482453.github.io/module/openfeign/openfeign-sheng-tai/openfeign-ji-cheng-hystrix/openfeign-ji-cheng-hystrix-ji-ben-gong-zuo-yuan-li/">https://yu627482453.github.io/module/openfeign/openfeign-sheng-tai/openfeign-ji-cheng-hystrix/openfeign-ji-cheng-hystrix-ji-ben-gong-zuo-yuan-li/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yu627482453.github.io" target="_blank">蝶梦庄生</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%A1%8C%E5%8A%A8%E9%98%B6%E6%AE%B5-%E5%AE%8C%E6%88%90/">行动阶段/完成</a><a class="post-meta__tags" href="/tags/%E4%B8%BB%E9%A2%98%E5%9C%BA%E6%99%AF-%E7%BB%84%E4%BB%B6/">主题场景/组件</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0%E7%A9%BA%E9%97%B4-KnowladgeSpace-ProgramSpace-ModuleSpace/">笔记空间/KnowladgeSpace/ProgramSpace/ModuleSpace</a><a class="post-meta__tags" href="/tags/%E7%BB%86%E5%8C%96%E4%B8%BB%E9%A2%98-Module-OpenFeign-%E7%94%9F%E6%80%81-Hystrix/">细化主题/Module/OpenFeign/生态/Hystrix</a></div><div class="post_share"><div class="social-share" data-image="https://api.yimian.xyz/img?type=moe" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/reward/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/reward/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/reward/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/module/openfeign/openfeign-gong-neng/openfeign-gong-neng/"><img class="prev-cover" src="https://api.yimian.xyz/img?type=moe" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【OpenFeign】 功能</div></div></a></div><div class="next-post pull-right"><a href="/module/openfeign/openfeign-sheng-tai/openfeign-ji-cheng-hystrix/openfeign-ji-cheng-hystrix-ji-chu/"><img class="next-cover" src="https://api.yimian.xyz/img?type=moe" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【OpenFeign】 集成 Hystrix 基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/module/openfeign/openfeign-sheng-tai/openfeign-ji-cheng-hystrix/openfeign-ji-cheng-hystrix-ji-chu/" title="【OpenFeign】 集成 Hystrix 基础"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-02</div><div class="title">【OpenFeign】 集成 Hystrix 基础</div></div></a></div><div><a href="/module/eureka/eureka/" title="Eureka"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="title">Eureka</div></div></a></div><div><a href="/module/flowable/flowable/" title="Flowable"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="title">Flowable</div></div></a></div><div><a href="/module/kafka/kafka/" title="Kafka"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-14</div><div class="title">Kafka</div></div></a></div><div><a href="/module/elasticsearch/elasticsearch-ji-ben-gai-nian/" title="【ElasticSearch】 基本概念"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-20</div><div class="title">【ElasticSearch】 基本概念</div></div></a></div><div><a href="/module/elasticsearch/elasticsearch-elasticsearch-he-kibana-an-zhuang/" title="【ElasticSearch】 ElasticSearch和Kibana安装"><img class="cover" src="https://api.yimian.xyz/img?type=moe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-20</div><div class="title">【ElasticSearch】 ElasticSearch和Kibana安装</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Bill Cipher</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">574</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">122</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yu627482453"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/yu627482453" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/627482453@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">【OpenFeign】 集成 Hystrix 基本工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Metadata-539"><span class="toc-number">1.1.</span> <span class="toc-text">Metadata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90OpenFeign%E3%80%91-%E9%9B%86%E6%88%90-Hystrix-%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">【OpenFeign】 集成 Hystrix 基本工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA-HystrixCommand-%E6%88%96-HystrixObservableCommand-%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.3.</span> <span class="toc-text">1. 构造一个 HystrixCommand 或 HystrixObservableCommand 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.</span> <span class="toc-text">2. 执行命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%93%8D%E5%BA%94%E6%98%AF%E5%90%A6%E8%A2%AB%E7%BC%93%E5%AD%98%EF%BC%9F"><span class="toc-number">1.5.</span> <span class="toc-text">3. 响应是否被缓存？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%96%AD%E8%B7%AF%E5%99%A8%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%EF%BC%9F"><span class="toc-number">1.6.</span> <span class="toc-text">4. 断路器是否开启？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%BA%BF%E7%A8%8B%E6%B1%A0-%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%98%AF%E5%90%A6%E5%B7%B2%E6%BB%A1%EF%BC%9F"><span class="toc-number">1.7.</span> <span class="toc-text">5. 线程池 &#x2F; 信号量是否已满？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-HystrixObservableCommand-construct-%E6%88%96-HystrixCommand-run"><span class="toc-number">1.8.</span> <span class="toc-text">6.HystrixObservableCommand.construct() 或 HystrixCommand.run()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E8%AE%A1%E7%AE%97%E6%96%AD%E8%B7%AF%E5%99%A8%E5%81%A5%E5%BA%B7%E7%8A%B6%E6%80%81"><span class="toc-number">1.9.</span> <span class="toc-text">7. 计算断路器健康状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E8%8E%B7%E5%8F%96%E9%99%8D%E7%BA%A7"><span class="toc-number">1.10.</span> <span class="toc-text">8. 获取降级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E8%BF%94%E5%9B%9E%E6%88%90%E5%8A%9F%E5%93%8D%E5%BA%94"><span class="toc-number">1.11.</span> <span class="toc-text">9. 返回成功响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-number">1.12.</span> <span class="toc-text">线程和线程池</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">1.13.</span> <span class="toc-text">线程池的好处</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">1.14.</span> <span class="toc-text">线程池的缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%88%90%E6%9C%AC"><span class="toc-number">1.15.</span> <span class="toc-text">线程成本</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/module/flowable/flowable-zhuan-lan/flowable-zhuan-lan/" title="无题"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/module/flowable/flowable-zhuan-lan/flowable-zhuan-lan/" title="无题">无题</a><time datetime="2023-07-15T09:45:06.401Z" title="发表于 2023-07-15 17:45:06">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/module/consul/part/consul-tong-yong-pei-zhi-shu-xing/" title="无题"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/module/consul/part/consul-tong-yong-pei-zhi-shu-xing/" title="无题">无题</a><time datetime="2023-07-15T09:44:38.408Z" title="发表于 2023-07-15 17:44:38">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/java/java-duo-xian-cheng-bing-fa/java-duo-xian-cheng-bing-fa-xian-cheng/java-duo-xian-cheng-bing-fa-xian-cheng/" title="【Java 多线程并发】 线程"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Java 多线程并发】 线程"/></a><div class="content"><a class="title" href="/java/java-duo-xian-cheng-bing-fa/java-duo-xian-cheng-bing-fa-xian-cheng/java-duo-xian-cheng-bing-fa-xian-cheng/" title="【Java 多线程并发】 线程">【Java 多线程并发】 线程</a><time datetime="2023-07-10T06:15:00.000Z" title="发表于 2023-07-10 14:15:00">2023-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/java/java-jvm/java-jvm-nei-cun-guan-li/java-jvm-zhi-jie-nei-cun/" title="【Java JVM】 直接内存"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Java JVM】 直接内存"/></a><div class="content"><a class="title" href="/java/java-jvm/java-jvm-nei-cun-guan-li/java-jvm-zhi-jie-nei-cun/" title="【Java JVM】 直接内存">【Java JVM】 直接内存</a><time datetime="2023-07-10T00:00:00.000Z" title="发表于 2023-07-10 08:00:00">2023-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/database/redis/redis-chong-dian-gong-neng/redis-pai-xu/" title="【Redis】 排序"><img src="https://api.yimian.xyz/img?type=moe" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Redis】 排序"/></a><div class="content"><a class="title" href="/database/redis/redis-chong-dian-gong-neng/redis-pai-xu/" title="【Redis】 排序">【Redis】 排序</a><time datetime="2023-07-09T06:07:00.000Z" title="发表于 2023-07-09 14:07:00">2023-07-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Bill Cipher</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'c61a274b6f5aa26a58f6',
      clientSecret: '485a7761d321c8dcc5cae05d7256be9fb196d94a',
      repo: 'yu627482453.github.io',
      owner: 'yu627482453',
      admin: ['yu627482453'],
      id: 'b88e96502dbfaaa0927e1d2842b0725e',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>